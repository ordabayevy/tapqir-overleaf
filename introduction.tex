\section*{Introduction}

%Nature Methods says: To enhance the practical relevance of each paper, description of the method must be accompanied by its validation, its application to an important biological question and results illustrating its performance in comparison to available approaches. Articles are selected for publication that present broad interest, thorough assessments of methodological performance and comprehensive technical descriptions that facilitate immediate application.

A central concern of modern biology is understanding at the molecular level the chemical and physical mechanisms by which protein and nucleic acid macromolecules  perform essential cellular functions.  The operation of many such macromolecules requires that they work not as isolated molecules in solution but as components of dynamic molecular complexes that self-assemble and change structure and composition as they function.  For more than  two decades, scientists have successfully explored the molecular mechanisms of many such complex and dynamic systems using multi-wavelength single molecule fluorescence methods such as smFRET (single-molecule fluorescence resonance energy transfer) \cite{Roy2008-fo} and single-molecule colocalization methods like CoSMoS (colocalization single molecule spectroscopy) \cite{Larson2014-os, Van_Oijen2011-ig}.

CoSMoS is a technique to measure the kinetics of dynamic interactions between individual molecules.  The CoSMoS method has been used for elucidating the mechanisms of complex biochemical processes \textit{in vitro}. Examples include cell cycle regulation \cite{Lu2015-eu}, ubiquitination and proteasome-mediated protein degradation \cite{Lu2015-jq}, DNA replication \cite{Geertsema2014-bt,Ticau2015-ib}, transcription \cite{Zhang2012-no,Friedman2012-if,Friedman2013-sf}, micro-RNA regulation \cite{Salomon2015-kq}, pre-mRNA splicing \cite{Shcherbakova2013-bi, Krishnan2013-fy, Warnasooriya2014-ls}, ribosome assembly \cite{Kim2014-zc}, translation \cite{Wang2015-tt,Tsai2014-mi,OLeary2013-wo}, signal recognition particle-nascent protein interaction \cite{Noriega2014-vj}, and cytoskeletal regulation \cite{Smith2013-qj,Breitsprecher2012-mj}. 

Fig. 1a illustrates an example CoSMoS experiment to measure the interaction kinetics of RNA polymerase molecules with DNA. In the experiment \cite{Rosen2020-zn}, we first measured the locations of individual DNA molecules (the ``targets'') tethered to the surface of an observation chamber at low density. Next, a solution containing RNA polymerase II molecules (the ``binders'') was added to the solution over the surface and the chamber surface was imaged by TIRF (total internal reflection fluorescence) microscopy. When the binder molecules are freely diffusing in solution, they are not visible in TIRF. In contrast, when bound to a target, a single binder molecule is detected as a discrete fluorescent spot colocalized with the target position \cite{Friedman2006-kb, Friedman2015-nx}.

Effective data analysis is a major challenge in the use of the CoSMoS technique. The basic goal is to acquire information at each time point about whether a binder molecule fluorescence spot is observed at the image position of a target molecule (e.g., whether a colocalized green RNA polymerase is observed at the surface location of a blue DNA spot in Fig. 1b). Although CoSMoS images are conceptually simple -- they consist only of diffraction-limited fluorescent spots collected in several wavelength channels -- efficient analysis of the images is inherently challenging. The number of photons emitted by a single fluorophore is limited by fluorophore photobleaching. Consequently, it is desirable to work at the lowest feasible excitation power in order to maximize the duration of experimental recordings and to efficiently capture relevant reaction events. Achieving higher time resolution divides the number of emitted photons between a larger number of images, so that photon shot noise ordinarily dominates the data statistics. Furthermore, the required concentrations of binder molecules can sometimes create significant background noise \cite{Peng2018-ge, Van_Oijen2011-ig}, even with zero-mode waveguide instruments \cite{Chen2014-jd}. These technical difficulties result in CoSMoS images that frequently have low signal-to-noise ratios (SNR), making discrimination of real fluorescent spots from noise a significant challenge. Also, there are usually non-specific interactions of the binder molecule with the chamber surface, and these artefacts can give rise to both false positive and false negative spot detection. These defects in analyzing spot colocalization interfere with the interpretation of CoSMoS data to measure reaction thermodynamics and kinetics and to infer molecular mechanisms.

Most CoSMoS spot detection methods are based on integrating the binder fluorescence intensity over small regions of the image  centered on the location of individual target molecules, and then using crossings of an intensity threshold to score binder molecule arrival and departure \cite{Friedman2015-nx}. However, integration discards data about the spatial distribution of intensity that can (and should) be used to distinguish authentic on-target spots from artefacts caused by noise or off-target binding.  More recently, improved methods \cite{Friedman2015-nx,Smith2019-yb} were developed that directly analyze TIRF images, using the spatial distribution of binder fluorescence intensity around the target molecule location. All of these methods, whether image- or integrated intensity-based, make a binary decision about the presence or absence of a binder spot at the target location.  Treating all binary decisions as equal neglects differences in the confidence of each spot detection decision caused by variations in noise, signal intensity, and non-specific binding.  Failure to account for spot confidence decreases the reliability of downstream thermodynamic and kinetic analysis.

In this paper, we describe a qualitatively different method for analysis of CoSMoS data implemented in a computer program, Tapqir (Kazakh: clever or inventive; pronunciation: \emph{tap-keer}). Tapqir analyzes 2-D image data, not integrated intensities.  Unlike prior methods, our approach is based on an explicit, global model for CoSMoS image formation and uses Bayesian inference to determine the values of model parameters and their associated uncertainties. The model includes realistic shot noise in fluorescent spots and background, camera noise, the size and shape of spots, and the presence of both target-specific and nonspecific binder molecules in the images. Most importantly, instead of yielding a binary spot-/no-spot determination, the algorithm calculates the probability of a target-specific spot being present at each time point and target location. The calculated probability can then be used in subsequent analyses of the molecular thermodynamics and kinetics. Unlike alternative approaches, Tapqir does not use subjective threshold settings so it can be used effectively and accurately by non-expert practitioners. The program is implemented in the Python-based probabilistic programming language Pyro \cite{Bingham2019-qy}, which facilitates modification of the global model and efficient use of graphics processing unit (GPU)-based hardware for rapid parallel processing of data. 