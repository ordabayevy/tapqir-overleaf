%\beginpgfgraphicnamed{model-pca}
\begin{tikzpicture}

  % Define nodes

  % Y
  \node[obs] (D) {$\mathrm{D}$} ;

  % W and X
  \node[det, above=of D]            (mi) {$\mu^\mathrm{I}$} ; %
  \node[latent, left=of mi]  (b)   {$\mathrm{b}$}; %
  \node[det, above=of mi]      (ms) {$\mu^S$} ; % 
  \node[latent, above=of ms, xshift=-0.8cm] (w)   {$\mathrm{w}$}; %
  \node[latent, above=of ms, left=of w]  (h)   {$\mathrm{h}$}; %
  \node[latent, above=of ms, right=of w]  (x)   {$\mathrm{x}$}; %
  \node[latent, above=of ms, right=of x] (y)   {$\mathrm{y}$}; %


  % m and theta
  \node[latent, above=of x, xshift=-0.9 cm] (mt)   {$\mathbf{m}$ $\theta$}; %

  % Gates
  \gate {m-gate}
  {(h)(w)(x)(y)(ms)}
  {mt} ;


  % Connect w and x to the dot node
  \edge[]{mi}{D}
  \edge[]{ms,b}{mi}
  \edge[]{h,w,x,y}{ms}
  \edge[]{mt}{x,y}

  % Plates
  \plate {K} { %
    (m-gate) %
  } {$\forall k \in \{ 1..K \}$} ;
  \plate {F} { %
    (K)(D)
    (mt) %
    (mi) %
    (b) %
  } {$\forall f \in \{ 1..F \}$} ;
  \plate {N} { %
    (F)
  } {$\forall n \in \{ 1..N \}$} ;
  

\end{tikzpicture}
%\endpgfgraphicnamed