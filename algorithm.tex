\algrenewcommand\algorithmicrequire{\textbf{Model parameter:}}
\begin{algorithm}
\caption{Generative model for pixel intensities}
\label{alg:pseudocode}
\begin{algorithmic}[1]
\State $g \sim \mathbf{HalfNormal}(50)$
\Comment{camera gain}
\State $\sigma^{xy} \sim \mathbf{Exponential}(1)$
\Comment{std of on-target spot position (pixels)}
\State $\pi \sim \mathbf{Beta}(1/2, 1/2)$
\Comment{average specific binding probability}
\State $\lambda \sim \mathbf{Exponential}(1)$
\Comment{non-specific binding rate}
\ForAll{$\mathsf{AOI}[N]$}
    \State $\mu^b \sim \mathbf{HalfNormal}(1000)$
    \Comment{mean background intensity}
    \State $\sigma^b \sim \mathbf{HalfNormal}(100)$
    \Comment{std of background intensity}
    \ForAll{$\mathsf{frame}[F]$}
    \Comment{time-independent}
        \State $b \sim \mathbf{Gamma}(\mu^b, \sigma^b)$
        \Comment{background intensity}
        \State $\theta \sim \mathbf{Categorical}\left(1 - \pi, \frac{\pi}{K}, \dots, \frac{\pi}{K}\right)$
        \Comment{specific spot indicator}
        
        \ForAll{$\mathsf{spot}[K]$}
            \State $ m_{\mathsf{spot}(i)}
                \begin{cases}
                    = 1 & \text{if $\theta = i$} \\
                    \sim \mathbf{Bernoulli} \left( \sum_{k=1}^K \dfrac{k \cdot \mathbf{TruncatedPoisson}(k; \lambda, K)}{K} \right) & \text{if $\theta = 0$} \\
                    \sim \mathbf{Bernoulli} \left( \sum_{k=1}^{K-1} \dfrac{k \cdot \mathbf{TruncatedPoisson}(k; \lambda, K-1)}{K-1} \right) & \text{otherwise}
                \end{cases} $
            \Comment{spot presence indicator}
            \If{$m=1$}
            \Comment{if spot is present}
                \State $h \sim \textbf{HalfNormal}(10000)$
                \Comment{spot intensity}
                \State $w \sim \textbf{Uniform}(0.75, 2.25)$
                \Comment{spot width}
                \State $ x_{\mathsf{spot}(i)} \sim
                    \begin{cases}
                    \mathbf{AffineBeta}\left( x_c, \sigma^{xy}, -\dfrac{P+1}{2}, \dfrac{P+1}{2} \right) & \theta = i \\
                    \mathbf{Uniform}\left(-\dfrac{P+1}{2}, \dfrac{P+1}{2} \right) & \theta \neq i \end{cases} $
                \Comment{$x$-axis center}
                \State $ y_{\mathsf{spot}(i)} \sim
                    \begin{cases}
                    \mathbf{AffineBeta}\left( y_c, \sigma^{xy}, -\dfrac{P+1}{2}, \dfrac{P+1}{2} \right) & \theta = i \\
                    \mathbf{Uniform}\left(-\dfrac{P+1}{2}, \dfrac{P+1}{2} \right) & \theta \neq i \end{cases}
                    $
                \Comment{$y$-axis center}
                \ForAll{$\mathsf{pixelX}[P] \times \mathsf{pixelY}[P]$}
                \State $\mu^{S} =
                            \dfrac{h}{2 \pi w^2} \exp{\left ( -\dfrac{(i-x)^2 + (j-y)^2}{2w^2} \right)}$
                \Comment{2D Gaussian spot}
                \EndFor
            \ElsIf{$m=0$}
                \State $\mu^S = 0$
            \EndIf
        \EndFor
            
        \ForAll{$\mathsf{pixelX}[P] \times \mathsf{pixelY}[P]$}
            \State $\mu^I = b + \sum_{\mathsf{spot}[K]} m \odot \mu^S$
            \Comment{mean pixel intensity w/o offset}
            \State $I \sim \mathbf{Gamma} (\mu^I, \sqrt{\mu^I \cdot g})$
            \Comment{pixel intensity w/o offset}
            \State $\delta \sim \mathbf{Categorical}_{\{ \delta_r \}^R_{r=1}}(\mathbf{\pi}^\delta)$
            \Comment{offset signal}
            \State \Return $D = \delta + I$
            \Comment{observed pixel intensity}
        \EndFor
    \EndFor
\EndFor
\end{algorithmic}
\end{algorithm}